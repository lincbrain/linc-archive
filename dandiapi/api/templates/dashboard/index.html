{% extends "admin/base.html" %}

{% block title %} Data Dashboard {% endblock %}

{% block branding %}
<h1 id="site-name"><a href="{% url 'admin:index' %}">{{ site_header|default:_('Django administration') }}</a></h1>
{% endblock %}

{% block nav-global %}{% endblock %}

{% block content %}
<div id="content-main">
  <div>
    <h1>Orphaned Assets</h1>
    <p>There are currently {{ orphaned_asset_count }} Assets with no associated Versions.</p>
    {% if orphaned_asset_count %}
    <p>They can be cleaned up with the collect_garbage script.</p>
    {% endif %}
  </div>

  <div>
    <h1>Orphaned AssetBlobs</h1>
    <p>There are currently {{ orphaned_asset_blob_count }} AssetBlobs with no associated Assets.</p>
    {% if orphaned_asset_blob_count %}
    <p>They can be cleaned up with the collect_garbage script.</p>
    {% endif %}
  </div>

  {% if non_valid_assets %}
  <div>
    <h1>Non-valid Assets</h1>
    <p>There are currently {{ non_valid_asset_count }} Assets that are not valid.</p>
    <table>
      <caption>
        Some Assets that are not valid
      </caption>
      <thead>
        <tr>
          <td>ID</td>
          <td>Asset ID</td>
          <td>Asset Path</td>
          <td>Status</td>
          <td>Validation Errors</td>
          <td>Metadata</td>
          <td>Blob ID</td>
          <td>Size</td>
          <td>SHA256</td>
          <td>Versions</td>
        </tr>
      </thead>
      {% for asset in non_valid_assets %}
      <tr>
        <td>{{ asset.id }}</td>
        <td>{{ asset.asset_id }}</td>
        <td>{{ asset.path }}</td>
        <td>{{ asset.status }}</td>
        <td>{{ asset.validation_errors }}</td>
        <td>{{ asset.metadata }}</td>
        <td>{{ asset.blob.blob_id }}</td>
        <td>{{ asset.size }}</td>
        <td>{{ asset.blob.sha256 }}</td>
        <td>
          {% for version in asset.versions.all %}
          {{ version.dandiset.identifier }}/{{ version.version }},
          {% endfor %}
        </td>
      </tr>
      {% endfor %}
    </table>
  </div>
  {% else %}
  <div>No invalid assets to show!</div>
  {% endif %}

</div>
{% endblock %}
